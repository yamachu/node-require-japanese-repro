name: Windows Test
on: 
    - push
    - workflow_dispatch

jobs:
    test:
        runs-on: windows-latest
        strategy:
            matrix:
                locale:
                    - default
                    - ja-JP
        defaults:
            run:
                shell: pwsh
        steps:
        - uses: actions/checkout@v4
        - uses: actions/setup-node@v4
          with:
            node-version: 22.13.0
        - run: npm ci
        - name: Change locale if needed
          if: ${{ matrix.locale != 'default' }}
          run: |
            $locale = "${{ matrix.locale }}"
            Install-Language $locale -CopyToSettings
            Set-WinUILanguageOverride -Language $locale
            Set-WinSystemLocale -SystemLocale $locale
            Set-WinUserLanguageList -LanguageList $locale -Force
            Set-Culture $locale
        - name: Show CodePage
          run: chcp
        - name: Show Locale
          run: |
            # Get-WinUILanguageOverride
            Get-WinSystemLocale
            # Get-WinUserLanguageList
            Get-Culture
        - run: node main.js
